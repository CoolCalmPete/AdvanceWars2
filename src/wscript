#! /usr/bin/env python
# encoding: utf-8
# Thomas Nagy, 2006 (ita)

from logging import fatal, error
import sys, os
import Utils, Options, Configure

def set_options(opt):
	opt.add_option('--gui', type='string', default='GTK', help='Choose the GUI [GTK|COCOA]', dest='gui')
	pass

def configure(conf):
	windows = sys.platform.startswith('win')

	boost_flags = ' -lboost_filesystem -lboost_system -lboost_signals'

	conf.check_cfg(atleast_pkgconfig_version='0.0.0')

	if Options.options.gui == 'GTK':
		conf.check_cfg(package='gtkmm-2.4', args='--cflags --libs', uselib_store='GTKMM')
		conf.check_cfg(package='cairomm-1.0', args='--cflags --libs', uselib_store='CAIROMM')
		conf.check_cfg(package='libglademm-2.4', args='--cflags --libs', uselib_store='GLADEMM')
	elif Options.options.gui == 'COCOA' and not sys.platform.startswith('darwin'):
		raise Configure.ConfigurationError('Cocoa gui is only available under OS X')	
		return 0
		
	if windows:
		conf.env.append_value('CXXFLAGS', '-IC:\MinGW\local\include -Wall')
		conf.env.append_value('LINKFLAGS', '-LC:\MinGW\local\lib')
	else:
		conf.env.append_value('CXXFLAGS', '-I/usr/local/include -Wall')
		
	conf.env.append_value('LINKFLAGS', boost_flags)
		
	conf.sub_config('lib')
	
def build(bld):
	bld.add_subdirs('lib')

	netwars = bld.new_task_gen('cxx', 'staticlib')
	netwars.target = 'netwars'
	netwars.uselib_local = 'tinyxml'
	netwars.includes = '. lib'
	netwars.defines = 'TIXML_USE_TICPP=1 TIXML_USE_STL=1'
	netwars.find_sources_in_dirs('game game/game_mechanics game/map_loader game/units')

	if Options.options.gui == 'GTK':
		gui = bld.new_task_gen('cxx', 'program')
		gui.target = 'netwars'
		gui.uselib_local = 'netwars tinyxml'
		gui.uselib = 'GTKMM CAIROMM GLADEMM'
		gui.includes = '. lib'
		gui.defines = 'TIXML_USE_TICPP=1 TIXML_USE_STL=1 GUI_GTK=1'
		gui.find_sources_in_dirs('. gui gui/gtk')
		gui.install_path = '..'

